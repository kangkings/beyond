<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <video autoplay id="videoElement"></video>
    <button onclick="start()">시작</button>
    <script>
        const servers = {
            iceServers: [
                {
                    urls: 'stun:stun.l.google.com:19302'
                }
            ]
        }

        async function start(){
            const stream = await navigator.mediaDevices.getUserMedia({video: true});
            let pc = new RTCPeerConnection(servers);

            const peer = createPeer();
            stream.getTracks().forEach((track) => peer.addTrack(track, stream));

            const offer = pc.createOffer();
            console.log(offer);
            
        }

        // 피어 연결하는 함수
        function createPeer(){
            iceServers: [
                {
                    urls: 'stun:stun.l.google.com:19302'
                }
            ]
            const peer = new RTCPeerConnection(servers);

            // 내 SDP 정보를 다른 클라이언트에게 보내야할 때 실행되는 이벤트
            // ex) 내 SDP정보가 변경됐을 때
            peer.onnegitiationneeded = () => handleNegoticationNeededEvent(peer);            
        }

        // SDP를 백엔드에 보내는 함수
        async function handleNegoticationNeededEvent(peer){
                const offer = await peer.createOffer();
                
                await peer.setLocalDescription(offer);

                const data = {
                    sdp: peer.localDescription
                };

                console.log(data);

                const {result} = await axios.post("/broadcast",data);
            }
    </script>
</body>
</html>